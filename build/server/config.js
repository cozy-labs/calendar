// Generated by CoffeeScript 1.7.1
var americano, clientPath, fs, path, publicPath, root, staticMiddleware;

americano = require('americano');

path = require('path');

fs = require('fs');

root = path.join(path.dirname(fs.realpathSync(__filename)));

clientPath = path.join(root, '..', 'client');

publicPath = path.join(clientPath, 'public');

staticMiddleware = americano["static"](publicPath, {
  maxAge: 86400000
});

module.exports = {
  common: {
    use: [
      staticMiddleware, function(req, res, next) {
        req.url = req.url.replace('/public', '');
        return staticMiddleware(req, res, function(err) {
          if (req.url !== req.originalUrl) {
            req.url = '/public' + req.url;
          }
          return next(err);
        });
      }, americano.bodyParser({
        keepExtensions: true
      }), americano.errorHandler({
        dumpExceptions: true,
        showStack: true
      })
    ],
    set: {
      views: clientPath
    }
  },
  development: [americano.logger('dev')],
  production: [americano.logger('short')],
  plugins: ['americano-cozy-pouchdb']
};
