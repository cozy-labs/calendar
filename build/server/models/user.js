// Generated by CoffeeScript 1.9.0
var User, cozydb;

cozydb = require('cozy-db-pouchdb');

module.exports = User = {};

User.updateUser = function(callback) {
  return cozydb.api.getCozyUser(function(err, user) {
    if (err || !user) {
      console.log(err);
      User.timezone = 'Europe/Paris';
      User.email = '';
    } else {
      User.timezone = user.timezone || "Europe/Paris";
      User.email = user.email;
    }
    return typeof callback === "function" ? callback() : void 0;
  });
};

User.getUserInfos = function(callback) {
  return cozydb.api.getCozyUser(function(err, user) {
    var name, words, _ref;
    if (err) {
      return callback(err);
    }
    name = ((_ref = user.public_name) != null ? _ref.length : void 0) ? user.public_name : (words = user.email.split('@')[0].replace(/([\.-]+)/g, ' ').split(' '), words.map(function(word) {
      return word[0].toUpperCase() + word.slice(1);
    }).join(' '));
    return callback(null, {
      name: name,
      email: user.email
    });
  });
};
