// Generated by CoffeeScript 1.7.1
var americano, port, start;

americano = require('americano');

start = function(root, port, callback) {
  return americano.start({
    name: 'Calendar',
    port: port,
    host: process.env.HOST || "0.0.0.0",
    root: root || __dirname
  }, function(app, server) {
    var Realtimer, User, realtime;
    User = require('./server/models/user');
    Realtimer = require('cozy-realtime-adapter');
    realtime = Realtimer({
      server: server
    }, ['alarm.*', 'event.*']);
    realtime.on('user.*', function() {
      return User.updateTimezone();
    });
    return User.updateTimezone(function(err) {
      return callback(err, app, server);
    });
  });
};

if (!module.parent) {
  port = process.env.PORT || 9113;
  start(null, port, function(err) {
    if (err) {
      console.log("Initialization failed, not starting");
      console.log(err.stack);
      return process.exit(1);
    }
  });
}

module.exports.start = start;
